\section{Modeling}
\label{sec:modeling}

To assess the protocols impact on time to operational corruption the model developed in \cite{Ezhilchelvan2018} was extended\footnote{An implementation and empirical evaluation in an existing systems was not performed as such an evaluation would have been impractical (need to compare database state at end of experiment with the linearizable truth), slow (real time) and expensive (requiring many hours of storage and compute time)}.
A summary of the model is now provided, before discussing the extensions.

The system processes transactions that arrive in a Poisson stream with rate $\lambda$ per second.
To simplify the model, each transaction contains a random number of read operations, $K$, followed by a single write.
To model a scale-free graph, edges in the database are divided into $T$ types, popular edges types have higher access probabilities but are a smaller proportion of the total number of edges, $N$.
For each type, a fraction $f$ are distributed edges and the remainder are local edges.
The delay $d$ between a transaction completing a tentative write at one end and starting at another end is exponential distributed with a mean of $\mu$.
At any moment in time an edge can be in one of four states:
\begin{enumerate}
\item Local and clean.
\item Distributed and clean.
\item Half-corrupted distributed edge arising from a dirty write.
\item Semantically corrupted.
\end{enumerate}
% The valid state transitions are given in Figure \ref{state-transitions}. Note, only distributed edges can be in state 2, but any edge, including local ones, can be in state 3.

% \begin{figure}[ht]
%   \centering
%     \begin{tikzpicture}[node distance=2cm]
%       \node (n0) [circle,draw,radius=0.3, align=center,green] {0};
%       \node (n1) [circle,draw,radius=0.3, align=center, right of=n0,green] {1};
%       \node (n2) [circle,draw,radius=0.3, align=center, right of=n1,orange] {2};
%       \node (n3) [circle,draw,radius=0.3, align=center, right of=n2,red] {3};
%       \draw [thick,<-,>=stealth,green] (n1) to[out=-45,in=-135]  node[below] {$a_{2,1}$} (n2);
%       \draw [thick,->,>=stealth,orange] (n1)  to[out=0,in=-180] node[below] {$a_{1,2}$} (n2);
%       \draw  [thick,->,>=stealth,red] (n2) to[out=-45,in=-135]  node[below] {$a_{2,3}$} (n3);
%       \draw  [thick,->,>=stealth,red]  (n0) to[out=70,in=110] node[above] {$a_{0,3}$} (n3);
%       \draw  [thick,->,>=stealth,red]  (n1) to[out=45,in=135] node[above] {$a_{1,3}$} (n3);
%     \end{tikzpicture}
%     \caption{Edge transitions between clean, half-corrupted and semantically corrupt states.}
%     \label{state-transitions}
% \end{figure}

Probabilities are then derived for a given read operation returning a correct answer (states 1, 2 or the correct record in state 3) and all the reads by a given transaction returning correct answers. Then the probability of edge becoming half-corrupted $q_i$, by a given transaction arriving at time $t$ and operating on edge of type $i$ is derived. These probabilities are used to construct transition rates $a_{i,j}$ between states, which are used to simulate the process of corrupting the database and obtain estimates for the time to operational corruption, $U_{\gamma}$. At time $0$, all edges are clean (free from corruption), when a certain fraction, $\gamma$, of all edges become semantically corrupted, the database itself is said to be operationally corrupt. The reader is directed to \cite{Ezhilchelvan2018} and \cite{Webber2019} for a granular discussion of the initial model.

% (Appendix A)\footnote{To simplify the derivation of the new conflict probability it was assumed that messages sent from the same servers do not arrive out of order i.e. the interleaving in Figure 3(c) cannot occur.}.

The \tDelta protocol impacts the rate of corruption by reducing the probability a given transaction half-corrupts a distributed edge, $q^{new}_i$, see Appendix \ref{sec:deriv-confl-prob} for the derivation. Of interest, therefore, is: how large or small is the value of $U_\gamma$ for a given value of $\gamma$ under the \tDelta protocol? Moreover, to quantify the number of aborts, a second simulation which focused specifically on the subset of frequently accessed distributed edges was performed. The answers to these questions depends on several parameters characterizing the following systemic aspects:
\begin{itemize}
\item \emph{Database Size}. Size is expressed by the total number of edges $N$, and the fraction $f$ of distributed edges.
\item \emph{Workload}. Measured as transactions per second (TPS). Significant for measuring $U_{\gamma}$ are: the fraction of this load that writes after reads and the number of reads that precede a write.
\item \emph{Distributed Write Delays and Choosing $\Delta$}. The smaller the delays the less likely the bound $\Delta$ is violated. Conversely, smaller $\Delta$ is the more likely the bound $\Delta$ is violated.
\end{itemize}
